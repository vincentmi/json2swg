<html>
<Head>
	<title>Json2Swag</title>
	<link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
	<script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
	<style>
	
	.err textarea{
		background: red;
	}
</style>
	
</head>
<body>

<nav class="navbar  navbar-dark bg-primary">
  <span class="navbar-brand mb-0 h1">Json2swg</span>
  <span class="navbar-text">
    <a href="https://vnzmi.com" target="_blank">@vincentmi</a> 
    
  </span>
</nav>

<div class="container-fluid" style="margin-top:10px;">
  <div class="row">
    <div class="col-sm" id="datawarp">
      <textarea id=data style="height:500px;width:100%;"></textarea>
    </div>
    <div class="col-sm">
      <textarea id="result"  style="padding:10px;OVERFLOW-Y: auto; OVERFLOW-X:hidden;width:100%;height:500;background:#eee;padding:5px">
      </textarea>
    </div>
</div>
<div class="row">
	<div class="mx-auto"><img src="donate.png" border="0" style="height:400px;width:400px;"/></div>
</div>
</div>

<script>

var TAB_STRING = "    "

var DESC_MAP ={
	"id" : "ID流水号" ,
	"created_at":"创建时间",
	"updated_at" : "更新时间",
	"deleted_at" : "删除时间",
	"sort_order" : "显示顺序",
	"order_num" : "显示顺序",
	"email" : "邮件地址",
	"phone" :"手机号",
	"cellphone":"手机号",
	"status" : "状态",
	"amount":"数量",
	"name":"姓名",
	"title":"标题",
	"description":"描述",
	"memo":"备注",
	"remark":"备注"
}


function json2swag(data)
{
	let swg = "/**\n"
+"* @SWG\\Get( \n"
+"*    tags={\"模块名称\"},\n"
+"*    path=\"/sample\",\n"
+"*    summary=\"功能描述\",\n"

+"*    @SWG\\Parameter(name=\"page\", type=\"integer\", required=false, in=\"query\",description=\"页码\"),\n"

+"*    @SWG\\Response(\n"
+"*         response=\"200\",\n"
+"*         description=\"接口响应\",\n"
+"*         @SWG\\Schema(\n";
	if(typeof data == "object")
	{
		Object.keys(data).forEach(function(key){
				swg += _json2swg(key , data[key] , 3 ,false)
		});
	}
	swg +="*         )\n";
	swg +="*    )\n";
	swg +="* )\n"
	swg +="**/\n"
	return swg;
}



function str_repeat(str , repeat)
{
	let result = ''
	let i=0
	for ( i = 0 ; i < repeat ;i++)
	{
		result += str
	}
	return result;
}

function _typestr(v)
{
	let varT = typeof v 
	if( varT == "object" && Array.isArray(v)){
		return "array"
	}else if(varT == "object")
	{
		return "object"
	}else if(varT == "number"){
		return "integer"
	}else{
		return varT 
	}
}

function _json2swg(varName , varValue , level )
{
	let swg = "";
	var prefix = "";
	if(varValue == null)
	{
		varValue = ""	
	}

	let varType = _typestr(varValue)

	let prefix1 = '*'+str_repeat(TAB_STRING, level);

	if ( varType == "array"){

		if(varName == "")
		{
			swg += prefix1 + "@SWG\\Property( type=\"array\","+"\n";
		}else{
			swg += prefix1 + "@SWG\\Property( property=\""+varName+"\" ,type=\"array\","+"\n";
		}

		firstElement = varValue.pop()
		firstElementType = _typestr(firstElement)
		let prefix2 = '*'+str_repeat(TAB_STRING, level+1);
		swg += prefix2+'@SWG\\Items(type="'+firstElementType+'",'+"\n";
		swg += _json2swg("",firstElement,level+2,true)
		swg += prefix2 +"),\n"
		swg += prefix1 +"),\n"

	}else if(varType == "object"){
		if(varName == "")
		{
			//swg += prefix1 + "@SWG\\Property( type=\"object\","+"\n";
		}else{
			swg += prefix1 + "@SWG\\Property( property=\""+varName+"\" ,type=\"object\",description=\""+varName+" description\","+"\n";
		}
		Object.keys(varValue).forEach(function(key){
			swg += _json2swg(key , varValue[key] , level+1 )
		});
		if(varName == "")
		{
		}else{
			swg += prefix1 + "),\n"
		}
		
	}else{

		if(typeof DESC_MAP[varName] != "undefined" )
		{
			varDesc = DESC_MAP[varName]
		}else{
			varDesc = "填写描述"
		}
		
		if(varName == "")
		{
			swg += prefix1 +'@SWG\\Property( type="'+varType+'" , example="'+varValue+'",description="'+varDesc+'"),'+"\n";
		}else{
			swg += prefix1 +'@SWG\\Property( property="'+varName+'" , type="'+varType+'" , example="'+varValue+'",description="'+varDesc+'"),'+"\n";
		}
	}
	return swg
}


	$(
		function(){
			$("#data").keyup(
				function(){
					try{
						let data = $("#data").val()
						//data = data.replace(/\snull\s/,"null")
						let json = JSON.parse(data)
					
						let result = json2swag(json)
						$("#result").html(result)
						$("#datawarp").removeClass('err')
					}catch(e){
						console.log(e)
			
						$("#datawarp").addClass('err')
					}
					//result = result.replace(/\n/g,"<br/>")
					//result = result.replace(/ /g,"&nbsp")

					//console.log(result)
					
				}
			)
		}
	)
	</script>
</body>

	</html>
